---
title: "Data analysis"
author: matkob
date: 12.11.2020
output: html_notebook
---

```{r message=FALSE}
# uncomment for generating html file
# setwd('..')
library(dplyr)
library(knitr)
library(rmarkdown)

df <- read.csv('data/winemag-data_first150k.csv', header = TRUE)
head(df)
```
<h2>Price vs Points</h2>
```{r }
plot(x=df$price, xlab='price', y=df$points, ylab='points')
```
<h2>Price Outliers</h2>
```{r}
boxplot(df$price, horizontal=TRUE)
remove_outliers <- function(df, col) {
  df[!df[[col]] %in% boxplot.stats(df[[col]])$out, ]
}
remove_missing <- function(df) {
    df[complete.cases(df), ]
}
boxplot(remove_outliers(df, 'price')$price, horizontal=TRUE)
```
<h2>Price vs Points 2</h2>
```{r}
price_qnt <- remove_outliers(df, 'price')
plot(x=price_qnt$price, xlab='price', y=price_qnt$points, ylab='points')
```
<h2>Points</h2>
```{r}
hist(df$points, breaks=c(0, 25, 50, 75, 100), xlab='points', main='Points distribution')
plot(ecdf(df$points), main='Cumulative distribution of points')
hist(
    df$points,
    breaks=c(80,90,100),
    col=c('#74b9ff', '#e17055'),
    xlab='points',
    main='Points distribution'
)
```
<h2>Glove Values</h2>
```{r}
source("utils/loader_glove.r")
# loading glove dataset
vectors <- load_glove(oversampling = FALSE)
```
```{r}
hist(
  apply(vectors[[1]], 2, sd),
  breaks = c(0, 0.1, 0.2, 0.3),
  col=c('#74b9ff', '#e17055', '#fdcb6e'),
  cex.lab=2,
  xlab='std dev',
  main='Std dev distribution'
)
```
<h2>Words occurrence</h2>
```{r}
library(SnowballC)
library(tidytext)

data('stop_words')
descr <- df$description
descr <- gsub('@\\w+', '', descr)
# links
descr <- gsub('https?://.+', '', descr)
# digits
descr <- gsub('\\d+\\w*\\d*', '', descr)
descr <- gsub('#\\w+', '', descr)
descr <- gsub('[^\x01-\x7F]', '', descr)
# punctuation
descr <- gsub('[[:punct:]]', ' ', descr)
# new lines
descr <- gsub('\n', ' ', descr)
descr <- gsub('^\\s+', '', descr)
descr <- gsub('\\s+$', '', descr)
descr <- gsub('[ |\t]+', ' ', descr)
df['text'] <- descr
# sentences to words
text_data <- mutate(df, text = as.character(text)) %>%
    select(text) %>%
    unnest_tokens("word", text)
# removing stopwords
text_data <- data.frame(text_data$word[!(text_data$word %in% stop_words$word)])
names(text_data) <- 'word'
# counting occurrence
common <- text_data %>% count(word) %>% arrange(desc(n))
head(common, 10)
```